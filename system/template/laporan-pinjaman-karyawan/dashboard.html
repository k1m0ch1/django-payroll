{% extends 'base.html' %}
{% load static %}

{% block content %}
<div class="content-wrapper">
    <!-- Content Header (Page header) -->
    <section class="content-header">
      <div>
          <ol class="breadcrumb">
            <li><a href="#"><i class="fa fa-home"></i> Dashboard</a></li>
            <li><i class="fa fa-flask"></i> Data Master</li>
            <li class="active">Laporan Pinjaman Karyawan</li>
          </ol>
      </div>
    </section>

    <!-- Main content -->
    <section class="content">
      <div class="row">
          <div class="col-md-12">
              <div class="col-md-2">
                <p><h3 class="control-label">Laporan Pinjaman Karyawan</h3></p>
              </div>
          </div>                
      </div>

      <div class="row">
          <div class="col-md-12">
              <div class="col-md-2">
                <p><h4 class="control-label">---</h4></p>
              </div>
          </div>                
      </div>

      <div class="row">
          <div class="col-md-12">
            <div class="col-md-2">
              <label class="control-label">Masa Tenggang Closing</label>               
            </div>
            <input type="hidden" id="idmas" name="idmas" />
            <div class="col-md-10">
              <p class="" id="textMas">  </p>
              
              <button class="btn btn-primary" id="pilihMasaTenggangClosing" data-toggle="modal" data-target="#pilihMasaTenggangClosingModal"><i class="fa fa-plus"></i> Pilih Masa Tenggang Closing</button> 
              </div>             
          </div>                
      </div>
      
      <div class="row">
          <div class="col-md-12">
            <div class="col-md-2">
              <label class="control-label">List Karyawan</label>               
            </div>
            <input type="hidden" id="idKaryawan" name="idkaryawan" />
            <div class="col-md-10">
              <p class="" id="textKaryawan">  </p>
               
              <button class="btn btn-primary" id="pilihKaryawan" data-toggle="modal" data-target="#pilihKaryawanModal"><i class="fa fa-plus"></i> Pilih Karyawan</button> 
              <button class="btn btn-primary" id="pilihPerusahaan" data-toggle="modal" data-target="#pilihPerusahaanModal"><i class="fa fa-plus"></i> Pilih Perusahaan</button>
              <button class="btn btn-primary" id="pilihDepartemen" data-toggle="modal" data-target="#pilihDepartemenModal"><i class="fa fa-plus"></i> Pilih Departemen</button>              
              <button class="btn btn-primary" id="pilihBagian" data-toggle="modal" data-target="#pilihBagianModal"><i class="fa fa-plus"></i> Pilih Bagian</button>
              <button class="btn btn-primary" id="pilihGolongan" data-toggle="modal" data-target="#pilihGolonganModal"><i class="fa fa-plus"></i> Pilih Golongan</button>
              <button class="btn btn-primary" id="bersih"><i class="fa fa-plus"></i> Clear</button>  
              </div>             
          </div>                
      </div>

      <div class="row">
          <div class="col-md-12">
              <div class="col-md-2">
                <p><h4 class="control-label">Laporan Gaji</h4></p>
              </div>
          </div>                
      </div>

      <div class="row">
          <div class="col-md-12">
            <div class="col-md-2">
              <label class="control-label pull-right">Laporan Gaji</label>
            </div>
            <div class="form-group">
                <button class="btn btn-primary" id="btnposting"><i class="fa fa-plus"></i> Export</button> 
            </div>
          </div>          
      </div>

      <div class="row">
          <div class="col-md-12">
              <div class="box-body table-responsive">
              <table class="table table-hover" id="myTable">
                <thead><tr>
                  <th class="col-md-3">Nama File</th>
                  <th class="col-md-1">Action</th>
                </tr>
                </thead>
                <tbody>
                {% for data in files %}                
                <tr>
                  <td><a href="{% url 'download' 'laporan/pinjaman/' data.name %}" > {{ data.name }}</a></td>
                  <td>
                    <div class="btn-group btn-group-xs" role="group" aria-label="...">
                        <a data-confirm="Yakin mau Hapus data  ???" href="" class="btn btn-default"><i class="fa fa-trash"></i></a>
                        <a href="" class="btn btn-default"><i class="fa fa-pencil"></i></a>
                    </div>                  
                  </td>
                </tr>                
                {% endfor %}
                </tbody>
              </table>

            </div>
          </div>                
      </div>
      <!-- Your Page Content Here -->

    </section>
    <!-- /.content -->
  </div>

{% endblock %}

{% block footer %}
{% include "include/base-modal.html" %}
{% include "include/base-modal-perusahaan.html" %}
{% include "include/base-modal-departemen.html" %}
{% include "include/base-modal-bagian.html" %}
{% include "include/base-modal-golongan.html" %}
{% include "include/base-modal-masatenggangclosing.html" %}
{% endblock %}

{% block javascript %} 
  <script src="{% static 'plugins/jQuery/jquery-2.2.3.min.js' %}"></script>
  <!-- Bootstrap 3.3.6 -->
  <script src="{% static 'bootstrap/js/bootstrap.min.js' %}"></script>
  <!-- AdminLTE App -->
  <script src="{% static 'dist/js/app.min.js' %}"></script>
  <!-- SlimScroll 1.3.0 -->
  <script src="{% static 'plugins/slimScroll/jquery.slimscroll.min.js' %}"></script>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.11.2/moment.min.js"></script>
  <script src="{% static 'plugins/daterangepicker/daterangepicker.js' %}"></script>
  <script src="{% static 'plugins/datepicker/bootstrap-datepicker.js' %}"></script>
  <script src="{% static 'plugins/colorpicker/bootstrap-colorpicker.min.js' %}"></script>
  <script src="{% static 'plugins/timepicker/bootstrap-timepicker.min.js' %}"></script>
  <script src="{% static 'plugins/slimScroll/jquery.slimscroll.min.js' %}"></script>

  <script>
  $(function () {    
        
    $.ajax({
        type: "GET",
        url: 'http://{{ request.get_host }}/index/api/karyawan',
        success: function(result) {
            $('#contentKaryawan').html(result);
      }
    });

    $('#bersih').on("click", function(){
        $('#textKaryawan').text("");
        $('#idKaryawan').val("");   
        $.ajax({
            type: "GET",
            url: 'http://{{ request.get_host }}/index/api/karyawan',
            success: function(result) {
                $('#contentKaryawan').html(result);
          }
        });  
    });

    $('#btnposting').on("click", function(){
      $.ajax({
            type: "POST",
            url: 'http://{{ request.get_host }}/index/laporan/pinjaman/do',
            data: {idkaryawan: $('#idKaryawan').val() ,masatenggangclosing: $('#idmas').val() ,csrfmiddlewaretoken: '{{ csrf_token }}'},
            success: function(result) {
                // var mywindow = window.open('', 'PRINT');
                // mywindow.document.write(result);
                // $('#contentKaryawan').html(result);
                // mywindow.print();
                // $('#contentKaryawan').printElement();
                location.reload();
          }
        }); 
    });

    $('#pilihKaryawan').on("click", function(){
      $("#allkaryawan").attr('checked', false);
    });

    $("#diulang").on("click", function(){
      $('#perusahaan').prop('selectedIndex',0);
      $('#departemen').prop('selectedIndex',0);
      $('#bagian').prop('selectedIndex',0);
      $('#golongan').prop('selectedIndex',0);
      $('#idKaryawan').val("");
      $('#textKaryawan').text('');
    });

    $("#p-perusahaan").on("change", function(){
        var perusahaan = $("#p-perusahaan option:selected").text() == "Perusahaan" ? "": $("#p-perusahaan option:selected").text();
        var pval = $("#p-perusahaan option:selected").val() == "Perusahaan" ? "": $("#p-perusahaan option:selected").val();
        $("#textKaryawan").text("[ Semua Karyawan " + perusahaan + "]");
        $("#idKaryawan").val(pval + "&&&&");
    });    

    $("#d-departemen").on("change", function(){
        var perusahaan = $("#d-perusahaan option:selected").text() == "Perusahaan" ? "": $("#d-perusahaan option:selected").text();
        var departemen = $("#d-departemen option:selected").text() == "Departemen" ? "": " Departemen " + $("#d-departemen option:selected").text();
        var pval = $("#d-perusahaan option:selected").val() == "Perusahaan" ? "": $("#d-perusahaan option:selected").val();
        var dval = $("#d-departemen option:selected").val() == "Departemen" ? "": $("#d-departemen option:selected").val();
        $("#textKaryawan").text("[ Semua Karyawan " + perusahaan + " Departemen " + departemen + "]");
        $("#idKaryawan").val(pval + "&" + dval +"&&&");
    });

    $("#b-bagian").on("change", function(){
        var perusahaan = $("#b-perusahaan option:selected").text() == "Perusahaan" ? "": $("#b-perusahaan option:selected").text();
        var departemen = $("#b-departemen option:selected").text() == "Departemen" ? "": " Departemen " + $("#b-departemen option:selected").text();
        var bagian = $("#b-bagian option:selected").text() == "Bagian" ? "": "Bagian " + $("#b-bagian option:selected").text();
        var pval = $("#b-perusahaan option:selected").val() == "Perusahaan" ? "": $("#b-perusahaan option:selected").val();
        var dval = $("#b-departemen option:selected").val() == "Departemen" ? "": $("#b-departemen option:selected").val();
        var bval = $("#b-bagian option:selected").val() == "Bagian" ? "":$("#b-bagian option:selected").val();
        $("#textKaryawan").text("[ Semua Karyawan " + perusahaan + " Departemen " + departemen + " Bagian " + bagian + "]");
        $("#idKaryawan").val(pval + "&" + dval +"&" + bval + "&&");
    });

    $("#g-golongan").on("change", function(){
        var perusahaan = $("#g-perusahaan option:selected").text() == "Perusahaan" ? "": $("#g-perusahaan option:selected").text();
        var departemen = $("#g-departemen option:selected").text() == "Departemen" ? "": " Departemen " + $("#g-departemen option:selected").text();
        var bagian = $("#g-bagian option:selected").text() == "Bagian" ? "": "Bagian " + $("#g-bagian option:selected").text();
        var golongan = $("#g-golongan option:selected").text() == "Golongan" ? "": "Golongan " + $("#g-golongan option:selected").text();
        var pval = $("#g-perusahaan option:selected").val() == "Perusahaan" ? "": $("#g-perusahaan option:selected").val();
        var dval = $("#g-departemen option:selected").val() == "Departemen" ? "": $("#g-departemen option:selected").val();
        var bval = $("#g-bagian option:selected").val() == "Bagian" ? "":$("#g-bagian option:selected").val();
        var gval = $("#g-golongan option:selected").val() == "Golongan" ? "":$("#g-golongan option:selected").val();
        $("#textKaryawan").text("[ Semua Karyawan " + perusahaan + " Departemen " + departemen + " Bagian " + bagian + " Golongan " + golongan + "]");
        $("#idKaryawan").val(pval + "&" + dval + "&" + bval + "&" + gval + "&");
    });

    $("#m-masatenggangclosing").on("change", function(){
        var masatenggangclosing = $("#m-masatenggangclosing option:selected").text() == "Masa Tenggang Closing" ? "": $("#m-masatenggangclosing option:selected").text();
        var mval = $("#m-masatenggangclosing option:selected").val() == "Masa Tenggang Closing" ? "": $("#m-masatenggangclosing option:selected").val();
        $("#textMas").text(masatenggangclosing);
        $("#idmas").val(mval);
    });  

  });
</script>
{% endblock %}